# Build script for Travis CI
#

# use fast-boot container-based hosts
sudo: false 
dist: trusty

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS 

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success: 
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
  # as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
  # the artifact has a proper SNAPSHOT version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    tags: true

# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack: 
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
      - secure: "***"

# encrypted variables
env:
  global:
    - secure: "O0wL5ul8cuZ40SfVIdgGgiPyjD5DrySQFA/oTQbq7KhhkzLh0SE45qm95ED/7UAesYnBOTh8hTUkzMuBH8z9+iWTb7fakOj3xfvm+B9tsN/bdnQjJ0JuzSss2aaaLys4X92vc2oobDap3fz5CPzhaIEngm9rNG6sgt7SWPsMRGX+fuHCTFsvLy/xvajvajV768sDTvmAQhFihFVEmH5EZLOe8dsU1uQ/II/iUd3Rq55snbUzV0Ei3bUwOQU0jLhy2XjHdOdd68KD/wKwasc13IauHS+aLv8VJ3yAs4uR23TZSZvuRr/Hh3i9Fa32/ZG7cqsuzENX24/KVwufQDDxYkXtC+tXX+U1KpYA+L4wHu+MzVXUmgrnyG6sJKzwimv8bgJ10TlKYkuHRGUTToTbpeel8+Lyt6LCPlHIh1Cbm1JnpNk0w/Dx3PzRh5ApfZMx1i17aUttI/+QdPCBlAy53HATyeMhYKnHLzAwxSj4sunBh8EE16RqStuQKd0v+4PUctsCJaCvJ90Ou9Pu8tkRNt89djCVSn8Yy/8zjEWtWap3ukF71CeLxzLZF0II/HBSMSazc3IkNCpmpuuXivS/c8Q1Tf2WtwGZxJOF3hylTVFS/GKs04Nx/1D7493+IHF00un8CkTzCSBSoUYglpATYYYeH1KkeIGWvvPRvg6P8SU="
    - secure: "cmYHKZCveQdnomYlVsSYoNfs0wDi/tqba1E2rRb1OAHxI99Pt0UBJWmHDNrMgqy3c20B6bYbpTg6hJcF7lVOBgv2gLNws6iVV6gpBhYGRkwglIyYXutSe1NypFtwQM74d54FxS5K0IOMFTeuSjKZP9AfH9Em4nhuSO8WPhrKO4HV1V8pmfLMU2UL78B4X3nJ9Q/pJA9wiX0WaY/7Zm5C/T6iCcapY3z6Zx2qfuSSqVEx1MQ8hoihSwzou4j2t9sIOgOj0QC0O6BspcQIZga93RyGRzJoKL8zspeZrQRPfgQBZlTdTpsjlgH3aR7HHj9VOpGKO20WA9qAowPlVDE9PGJLDFXjHDeDJxcndI+1Zshs3A+fgxeuUHmWINHZ3g6CuOsTrH5OW9ZDHpmOSTkEKJ/PvAgZUSfdI4t0Ahs/O9vbtMiUAUYxivIdXQ0SOHToZm/lmW8oSUvOjFRv9/iECpDGEVZfuZnaPaJGit57rVl2dBGiiP9PBMuwyI76e2jwG/8piw6j7x3hrpx/+L0FMiVHIBnr9jMVqYghfgG4tGL5JvmqFHH7DnPoi7DwIJIMePkFYTaBXkoHe+tgHPHmDGgJfJvhmei0zzqM2tWA7y9rATEvc9fFgUb2yiot4j+gWWaaauDqvSKRxzf9B2895meOlcnsqJTbmMDerHv9hdA="