# Build script for Travis CI
#

# use fast-boot container-based hosts
sudo: false 
dist: trusty

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS 

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success: 
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
  # as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
  # the artifact has a proper SNAPSHOT version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    tags: true

# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack: 
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
      - secure: "***"

# encrypted variables
env:
  global:
    - secure: "xCKpRP4KvjlV8fZhr+j4Gnndj0FuUU1FOkqfkgl3dC4BlVOAdwR8ToVYo8y/WvWoDAi1yMw69IkXYPECj/tKfinbtpEkN661FBEwlaqAbg92TdT746KtOPzUHTfz6jznnq57wXUpJoQs+pL+eZnVmNPdQdpNH3XAT9y3/oXkZcVzvXIcx3juC/aCk/h1i5KkNUUkUgmb2bMbBl3n68E8k0qGwf1E91Cd9b/k/JW+/Of/b9Q9z5z+9teeZJYEVKP9M2OB9LtPW25hRpu7/SzBxt3YKcKzKW4h9ZaQMLTtDGZKMw6B7h95+y7aPxYC1kOKNcoUz0HSetAELfqxVkBnMTDjNL2Odcgwfk/pKOR7xsDQQqpi6SJekGFapVzp4NVq+luwX74PRWL6Ww03GN3Bi2gHkPWLNFTASfYs/rqgDBZcLWKTHAa/iMgskVk/DY5pLGr6eZSHOk1QIXksYBkwnL29ZsWoOsId9rdW4NU98H6vtMZXAunV7vtN8UeJdLbouQb1lYUjNRYEuIXSTQkMPz37XHGZ3obcT+ActvJvAjwOUPsw+tjQ7bIyRyqBXe7mP7R4dZwVYFFraeqqha1Bm9LoUBSXasB2zgo8S+g6VTl9Wi3ZAbx3Y8yvac8dkS3rpuyMjHlbO3c5o2QUwO5DO6wFV2CcB8hSnMtXR6bAwuU="
    - secure: "vTHn5o2J9xzBKjnR51fsim1TCkjxBadxqrbVfm47lR85EDa1yktxRJ60Hdve3ppyi2mW/A82+eCu04j6hgS85MhFRTCleiJDUoQ2Rx4o0VlkBEKYGyhm4ouuoJWIL904PVZomJ5o6NoPsWCEOfCxoJZlVIy7OKQNK+18UhwtjTWhwsOfau0rsv6sBKb+FYIsxCra9f0s2GogAYPP0vkmzUcqBZRUNo96AR3033Cog4lqxzveGEfUPlzWEu0iv1b/PSMcOV/cQvso9oSK7C5hAh4YnNRptAZ/2atW3eaVxR3b/j00ExL4zAKGkbwmvZeb/TMjVavUDHGX3VpPLtr9Z1izmI4eZVAWPNllMLbovJhMcvtoJd0vR9jm7khkoD0n7K9DMZR2eh7pURv31nGd9FWhzN0ArI02f07D99VRsHdJnqNXN2OUIn7TvkutkDg0FRa3ZOFy5UOECp5R+etdCZG4a7KUyDsYjhVo5PdGT2D6ufUdjfEeIIkQyXXAK+vDbJlr58UkBSCvSUeBlZVVPU0lF014eWXKS3Pgdn1MeFma9azCu59GueX7mGpaRriz+7/HV9CAW6fiuChoW3sffwEUsm6eIC9QicTgaqCuPcAIhCUJV/wk+cwuxxHeivTSE5ehrfEn+t5xi0mkweWKwD7t9IJVfTPZY0R9M+JxYM4="